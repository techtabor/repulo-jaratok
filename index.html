<!DOCTYPE html>
<html>
  <head>
    <title>Repülések</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" /> 
    <script src="http://maps.google.com/maps/api/js?sensor=false" 
          type="text/javascript"></script>
    <meta charset="utf-8">
    <style type="text/css">
      table {
        border-collapse: collapse;
      }
      table, td, th {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
  <pre id="fileDisplayArea"></pre>
    <div id="page-wrapper">
      <div>
        Select a text file: 
        <input type="file" id="fileInput">
      </div>
    </div>
    <div id="map" style="width: 500px; height: 400px;"></div>
    <table id="main">
      <tr id="head">
        <!--<th>Code From</th>
        <th>Code to</th> -->
        <th>City From</th>
        <th>City To</th>
        <!--<th>Transfer?</th>
        <th>Airline</th>>
        <th>Personal?</th>
        --><th>Date</th><!--
        <th>Date of Arrive</th>-->
      </tr>
    </table>
    <table id="cities">
      <tr id="head">
        <th>Cities</th>
      </tr>
    </table>
    <button type="button" onclick="reload_button()">Reload</button>

    <button type="button" onclick="show_map()">Show</button>

    <script>
      function show_map(){
        var tomb=[[]];
        var table = document.getElementById("cities");
        for(var i=1;i<table.rows.length;i++){
          var x = table.rows[i].cells;
          var t=[x[0].innerHTML,parseInt(x[1].innerHTML),parseInt(x[2].innerHTML),2];
          tomb.push(t);
        }
      //alert(tomb);
        set_map(tomb);
      }

      function reload_button()
      {
        var table = document.getElementById("cities");
        for(var i=1;i<table.rows.length;i++)
        {
          var x = document.getElementById("cities").rows[i].cells;
          if(x[1].innerHTML==""){
            get_coordinates(x[0].innerHTML,x[1],x[2]);
          }
        }
      }
    </script>

    <script sync>
      var elemNumber=3;
      window.onload = function() {
        var fileInput = document.getElementById('fileInput');
        var fileDisplayArea = document.getElementById('fileDisplayArea');
        fileInput.addEventListener('change', function(e) {
          var file = fileInput.files[0];
          var textType = /text.*/;
          var reader = new FileReader();
          reader.onload = function(e) {
            var data=reader.result;
            data = data.replace(/(?:\r\n|\r|\n)/g, '|');
            set(data);
            //fileDisplayArea.innerText = /*reader.result*/data;
          }
          reader.readAsText(file);    
        });
      }

      function set(data){
        var tableData= toArray(data);
        var varosok=[]; 
        //var nevek=gyakori(tableData);
        var table = document.getElementById("main");
        while(table.rows.length>1)table.deleteRow(0);
        for(var i=0;i<tableData.length;i++){
          if(tableData[i][0] != ""){
            var newRow = table.insertRow(table.rows.length);
            /*for(var j=0;j<elemNumber;j++){
              var cell = newRow.insertCell(j);
              cell.innerHTML = tableData[i][j];
            }*/
            var str1=tableData[i][0]/*.substring(1,tableData[i][0].length)*/;
            var str2= tableData[i][1]/*.substring(0,tableData[i][1].length-1)*/;
            var cell1 = newRow.insertCell(0);
            cell1.innerHTML = str1;
            var cell2 = newRow.insertCell(1);
            cell2.innerHTML =str2;
            var cell3 = newRow.insertCell(2);
            cell3.innerHTML =tableData[i][2];
            if(varosok.indexOf(str1)==-1)varosok.push(str1);
            if(varosok.indexOf(str2)==-1)varosok.push(str2);
           // var cell3 = newRow.insertCell(2);
           // var cell4 = newRow.insertCell(3);
           // var a=tableData[i][0].toString();
           // a=a.substring(1,tableData[i][0].length);
           // get_coordinates(a,cell3,cell4);
          }
        }
        var cities=document.getElementById("cities");
        for(var i=0;i<varosok.length;i++){
          var newRow = cities.insertRow(cities.rows.length);
          var cell1 = newRow.insertCell(0);
            cell1.innerHTML = varosok[i];
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);
            get_coordinates(varosok[i],cell2,cell3);
        }
       /* var csak=0;
        var kordin=get_coordinates(nevek[0]);
        while(reag==0)csak=0;
        var cor=[[nevek[0],kordin[0],kordin[1],1]];
        reag=0;
        for(var i=1;i<nevek.length;i++){
          var cord=get_coordinates(nevek[i]);
          while(reag==0)csak=0;
          reag=0;
          var uj=[nevek[i],cord[0],cord[1],i+1]
          cor.push(uj);
        }*/
      //  alert(cor.length);
       // set_map(cor);
      }

      function toArray(data){
        var tomb=data.split("|")
        var re=[];
        for(var i=0;i<tomb.length-1;i++){
          re.push(tomb[i].split(";"));
        }
        return re;
      }

      function gyakori(dataTomb){
        var gyakNev=[dataTomb[0][0]];
        var gyakNum=[0];
        for(var i=0;i<dataTomb.length;i++){
          for(var j=0;j<2;j++){
            if(dataTomb[i][j]!=""){
              var x=-1;
              for(var k=0;k<gyakNev.length;k++){
                if(gyakNev[k]==dataTomb[i][j]){x=k;gyakNum[k]++;}
              }
              if(x==-1){gyakNev.push(dataTomb[i][j]);gyakNum.push[1];}
            }
          }
        }
        var x=0;
        for(var i=0;i<gyakNev.length;i++){
          if(gyakNum[x]<gyakNum[i])x=i;
        }
        fileDisplayArea.innerText = "A leggyakrabbi varos: "+ gyakNev[x];
        return gyakNev;
      }
      
    //get_coordinates("budapest");
    function get_coordinates(name,cell3,cell4){ 
      //var a=0;
      //alert("alma");
     // var tomb=[];
            var geocoder =  new google.maps.Geocoder();
    geocoder.geocode( { 'address': name}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
           // alert("b");

            var a=results[0].geometry.location.lat();
            var b=results[0].geometry.location.lng();
            cell3.innerHTML=a;
            cell4.innerHTML=b;

           // alert("locathhhhion : " + a + " " +b); 
           // tomb=[a,b];
           // alert("c,");
            //a=1;
           // alert(tomb[0] + " " + tomb[1]);
          } else {
            //alert("Something got wrong " + status);
          }
        });
  //  while(a==0)var b=100000;
   // alert("b,");
    //reag=1;
   // return tomb;
    }
    function set_map(locations){
   /* var locations = [
      ['Bondi Beach', -33.890542, 151.274856, 2],
      ['Coogee Beach', -33.923036, 151.259052, 2],
      ['Cronulla Beach', -34.028249, 151.157507, 2],
      ['Manly Beach', -33.80010128657071, 151.28747820854187, 2],
      ['Maroubra Beach', -33.950198, 151.259302, 2]
    ];*/
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 3,
      center: new google.maps.LatLng(47.497, 19.040),
     // mapTypeId: google.maps.MapTypeId.ROADMAP
      mapTypeId: 'terrain'
    });
    var infowindow = new google.maps.InfoWindow();
    var marker, i;
    for (i = 0; i < locations.length; i++) {  
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
        map: map
      });
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(locations[i][0]);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }

/*var table = document.getElementById("cities");
       // var ures=0;
      // alert(table.rows.length);
        for(var i=1;i<table.rows.length;i++)
        {
          var x = document.getElementById("cities").rows[i].cells;
          if(x[1].innerHTML==""){
            get_coordinates(x[0].innerHTML,x[1],x[2]);
            //alert("a");
          }
        }*/

  var vars1=[];
  var vars2=[];
  var dar=[];
  var maxdar=1;
  var table = document.getElementById("main");
 // alert("k");
  for(var i=1;i<table.rows.length;i++){
    var x = table.rows[i].cells;
    var str1=x[0].innerHTML;
    var str2=x[1].innerHTML;
    if(str1>str2){
      var pot=str1;
      str1=str2;
      str2=pot;
    }
    if(vars1.indexOf(str1)==-1){
      vars1.push(str1);
      vars2.push(str2);
      dar.push(1);
    }
    else{
      var van=-1;
      for(var j=0;j<vars1.length;j++){
        if(vars1[j]==str1 && vars2[j]==str2)van=j;
      }
      if(van==-1){
        vars1.push(str1);
        vars2.push(str2);
        dar.push(1);
      }
      else{
        dar[j]+=1;
        if(dar[j]>maxdar)maxdar=dar[j];
      }
    }
  }
  var ci=[];
  var k1=[];
  var k2=[];
  var table2 = document.getElementById("cities");
  for(var i=1;i<table2.rows.length;i++){
    var x = table2.rows[i].cells;
    ci.push(x[0].innerHTML);
    k1.push(x[1].innerHTML);
    k2.push(x[2].innerHTML);
  }
  var keszAdatok=[[]];
  for(var i=0;i<vars1.length;i++){
    var ujSor=[];
    ujSor.push(k1[ci.indexOf(vars1[i])]);
    ujSor.push(k2[ci.indexOf(vars1[i])]);
    ujSor.push(k1[ci.indexOf(vars2[i])]);
    ujSor.push(k2[ci.indexOf(vars2[i])]);
    var alk=0.1;
    alk=parseInt(dar[i])/parseInt(maxdar)*5;
    if(isNaN(alk))alk=1;
    ujSor.push(alk);
    
    keszAdatok.push(ujSor);
  }
  for(var i=1;i< keszAdatok.length;i++){
    var alkk=1.1;
    alkk=keszAdatok[i][0];
    var flightPlanCoordinates = [
    {lat: parseFloat(keszAdatok[i][0]), lng: parseFloat(keszAdatok[i][1])},
    {lat: parseFloat(keszAdatok[i][2]), lng: parseFloat(keszAdatok[i][3])}/*,
    {lat: -48.142, lng: 178.431},
    {lat: -47.467, lng: 153.027}*/
  ];

  var flightPath = new google.maps.Polyline({
    path: flightPlanCoordinates,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: parseFloat(keszAdatok[i][4])
  });
  flightPath.setMap(map);
  }
  //flightPath.setMap(map);
  
  }
  </script>

  </body>
</html>